objects:
  - object: XmZoomeyeUpgradeClient
    class: upgradeclient.xm_zoomeye_upgradeclient.XmZoomeyeUpgradeClient
    scope: singleton
    properties:
      download_service: {ref: DownloadService}
      upload_service: {ref: UploadService}
      alert_service: None
      webui_service: {ref: WebuiService}
      check_service: {ref: CheckService}
      constructor-args: {download_service: download_service, upload_service: upload_service, alert_service: alert_service, check_service: check_service)}

  - object: WebuiService
    class: upgradeclient.service.webui_service.WebuiService
    scope: singleton
    properties:
      port: 80
    constructor-args: [{port: port}]

  - object: UploadService
    class: upgradeclient.service.upload_service.UploadService
    scope: singleton
    properties:
      cache: {ref: Cache}
      check_interval: 15
      dao_factory:
        rsync: {ref: RsyncDao}
      upload_factory:
        rsync: {ref: RsyncHandler}
    constructor-args: {cache: cache, check_interval: check_interval, dao_factory: dao_factory, upload_factory: upload_factory}

  - object: RsyncDao
    class: upgradeclient.domain.dao.rsync_dao.RsyncDao
    scope: singleton
    properties:
      conf_path: /etc/upgradeclient/upload.json
    constructor-args: {conf_path: conf_path}

  - object: RsyncHandler
    class: upgradeclient.domain.bl.handlers.upload.rsync.RsyncHandler
    scope: singleton
    properties:
      cache: {ref: Cache}
    constructor-args: {cache: cache}

  - object: CheckService
    class: upgradeclient.service.check_service.CheckService
    scope: singleton
    properties:
      check: {ref: Check}
      cache: {ref: Cache}
      dao_factory:
        dvr: {ref: DvrDao}
        ipc: {ref: IpcDao}
        xmjp: {ref: XmjpDao}
      filter_factory:
        dvr: {ref: DvrFilter}
        ipc: {ref: IpcFilter}
        xmjp: {ref: XmjpFilter}
    constructor-args: {check: check, cache: cache, dao_factory: dao_factory, filter_factory: filter_factory}

  - object: DownloadService
    class: upgradeclient.service.download_service.DownloadService
    scope: singleton
    properties:
      cache: {ref: Cache}
      handler_factory: {ref: DownloadHandlerFactory}
      relative_path: check_cache
      check_interval: 15
    constructor-args: {cache: cache, handler_factory: handler_factory, relative_path: relative_path, check_interval: check_interval}

  - object: DownloadHandlerFactory
    class: upgradeclient.domain.bl.download_handler_factory.DownloadHandlerFactory
    scope: singleton
    properties:
      download_handlers:
        default: {ref: DefaultHandler}
        downloading_firmware: {ref: FirmwareHandler}
        downloading_releasenote: {ref: ReleaseNoteHandler}
    constructor-args: {download_handlers: download_handlers}

  - object: DefaultHandler
    class: upgradeclient.domain.bl.handlers.download.default.DefaultHandler
    scope: singleton
    properties:
      cache: {ref: Cache}
      dao_factory:
        dvr: {ref: DvrDao}
        ipc: {ref: IpcDao}
        xmjp: {ref: XmjpDao}
    constructor-args: {cache: cache, dao_factory: dao_factory}

  - object: FirmwareHandler
    class: upgradeclient.domain.bl.handlers.download.firmware.FirmwareHandler
    scope: singleton
    properties:
      cache: {ref: Cache}
      dao_factory:
        dvr: {ref: DvrDao}
        ipc: {ref: IpcDao}
        xmjp: {ref: XmjpDao}
    constructor-args: {cache: cache, dao_factory: dao_factory}

  - object: ReleaseNoteHandler
    class: upgradeclient.domain.bl.handlers.download.release_note.ReleaseNoteHandler
    scope: singleton
    properties:
      cache: {ref: Cache}
      dao_factory:
        dvr: {ref: DvrDao}
        ipc: {ref: IpcDao}
        xmjp: {ref: XmjpDao}
    constructor-args: {cache: cache, dao_factory: dao_factory}

  - object: Check
    class: upgradeclient.domain.utils.check.Check
    scope: singleton
    constructor-args: {}

  - object: Cache
    class: upgradeclient.domain.utils.cache.Cache
    scope: singleton
    properties:
      base_path: /tmp/xm_zoomeye_upgradeclient/
    constructor-args: {base_path: base_path}

  - object: DvrDao
    class: upgradeclient.domain.dao.dvr_dao.DvrDao
    scope: singleton
    properties:
      conf_path: /etc/upgradeclient/global.json
    constructor-args: {conf_path: conf_path}

  - object: IpcDao
    class: upgradeclient.domain.dao.ipc_dao.IpcDao
    scope: singleton
    properties:
      conf_path: /etc/upgradeclient/global.json
    constructor-args: {conf_path: conf_path}

  - object: XmjpDao
    class: upgradeclient.domain.dao.xmjp_dao.XmjpDao
    scope: singleton
    properties:
      conf_path: /etc/upgradeclient/global.json
    constructor-args: {conf_path: conf_path}

  - object: DvrFilter
    class: upgradeclient.domain.bl.filter.check.dvr_filter.DvrFilter
    scope: singleton
    constructor-args: {}

  - object: IpcFilter
    class: upgradeclient.domain.bl.filter.check.ipc_filter.IpcFilter
    scope: singleton
    constructor-args: {}

  - object: XmjpFilter
    class: upgradeclient.domain.bl.filter.check.xmjp_filter.XmjpFilter
    scope: singleton
    constructor-args: {}
